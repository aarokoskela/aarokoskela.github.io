<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tulospalvelu</title>
    <style>
        :root {
            --header-bg:   #166534;
            --header-hi:   #4ade80;
            --accent:      #16a34a;
            --fpl-color:   #7c3aed;
            --bg:          #f0fdf4;
            --card-bg:     #e0f2fe;
            --card-border: #bae6fd;
            --card-hover:  #16a34a;
            --muted:       #6b7280;
            --text:        #1f2937;
            --bar-home:    #16a34a;
            --bar-away:    #ef4444;
            --sidebar-bg:  #0d3d23;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        /* ‚îÄ‚îÄ App Layout ‚îÄ‚îÄ */
        .app-layout {
            display: flex;
            min-height: 100vh;
        }

        /* ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ */
        .sidebar {
            width: 210px;
            flex-shrink: 0;
            background: var(--sidebar-bg);
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(255,255,255,0.1) transparent;
        }

        .sidebar-title {
            padding: 18px 16px 14px;
            font-size: 1.0em;
            font-weight: 800;
            color: #fff;
            letter-spacing: 0.3px;
            border-bottom: 1px solid rgba(255,255,255,0.08);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sidebar-section { padding-top: 6px; }

        .sidebar-section-label {
            font-size: 0.67em;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: #4ade80;
            padding: 10px 16px 5px;
            font-weight: 700;
        }

        .league-btn {
            display: flex;
            align-items: center;
            gap: 7px;
            width: 100%;
            background: transparent;
            border: none;
            border-left: 3px solid transparent;
            text-align: left;
            color: rgba(255,255,255,0.6);
            padding: 8px 14px;
            cursor: pointer;
            font-size: 0.845em;
            transition: background 0.15s, color 0.15s, border-color 0.15s;
        }

        .league-btn:hover {
            background: rgba(255,255,255,0.07);
            color: rgba(255,255,255,0.9);
        }

        .league-btn.active {
            background: rgba(255,255,255,0.1);
            color: #fff;
            font-weight: 700;
            border-left-color: #4ade80;
        }

        .lb-icon { font-size: 0.95em; flex-shrink: 0; }

        /* ‚îÄ‚îÄ Main content ‚îÄ‚îÄ */
        .main-content {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
        }

        /* ‚îÄ‚îÄ League header ‚îÄ‚îÄ */
        .league-header {
            background: var(--header-bg);
            padding: 16px 20px 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 3px solid var(--header-hi);
        }

        .league-header img {
            width: 40px;
            height: 40px;
            object-fit: contain;
            flex-shrink: 0;
        }

        .league-header-text h1 {
            font-size: 1.4em;
            color: #fff;
            font-weight: 700;
            line-height: 1.2;
        }

        .league-header-text p {
            font-size: 0.78em;
            color: #bbf7d0;
            margin-top: 3px;
        }

        /* ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ */
        .tabs {
            display: flex;
            gap: 10px;
            padding: 13px 16px;
            background: var(--header-bg);
            flex-wrap: wrap;
        }

        .tab-btn {
            background: transparent;
            border: 2px solid var(--header-hi);
            color: #fff;
            padding: 7px 20px;
            border-radius: 22px;
            cursor: pointer;
            font-size: 0.88em;
            transition: all 0.2s;
        }

        .tab-btn.active, .tab-btn:hover {
            background: #fff;
            color: var(--header-bg);
            font-weight: bold;
        }

        /* ‚îÄ‚îÄ Container ‚îÄ‚îÄ */
        .container {
            max-width: 820px;
            margin: 22px auto;
            padding: 0 14px;
            width: 100%;
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* ‚îÄ‚îÄ Loading ‚îÄ‚îÄ */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: var(--accent);
            font-size: 1em;
        }

        .spinner {
            width: 36px; height: 36px;
            border: 3px solid #bbf7d0;
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
            margin: 0 auto 14px;
        }

        .spinner-sm {
            width: 22px; height: 22px;
            border: 2px solid #bbf7d0;
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
            margin: 14px auto;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* ‚îÄ‚îÄ Section info / headers ‚îÄ‚îÄ */
        .section-info {
            font-size: 0.78em;
            color: var(--muted);
            text-align: center;
            margin-bottom: 18px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .matchday-header {
            font-size: 0.78em;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--muted);
            margin: 22px 0 8px;
            border-left: 3px solid var(--accent);
            padding-left: 8px;
        }

        /* ‚îÄ‚îÄ Match card ‚îÄ‚îÄ */
        .match-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 16px 18px;
            margin-bottom: 12px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .match-card.has-btns {
            cursor: pointer;
        }

        .match-card.has-btns:hover {
            border-color: var(--card-hover);
            box-shadow: 0 3px 16px rgba(22,163,74,0.12);
        }

        .match-card.panel-open {
            border-color: var(--card-hover);
            box-shadow: 0 3px 16px rgba(22,163,74,0.12);
        }

        /* ‚îÄ‚îÄ Match meta & teams ‚îÄ‚îÄ */
        .match-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.76em;
            color: var(--muted);
            margin-bottom: 12px;
            gap: 8px;
        }

        .match-status {
            font-size: 0.85em;
            padding: 2px 8px;
            border-radius: 8px;
            flex-shrink: 0;
        }

        .status-ft   { background: #dcfce7; color: #15803d; }
        .status-live { background: #fee2e2; color: #dc2626; animation: pulse 1s infinite; }
        .status-pre  { background: #f0fdf4; color: var(--accent); border: 1px solid #bbf7d0; }

        @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.5} }

        .match-teams {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .team {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            gap: 7px;
            min-width: 0;
        }

        .team img {
            width: 52px; height: 52px;
            object-fit: contain;
        }

        .team-name {
            font-size: 0.85em;
            font-weight: 600;
            text-align: center;
            line-height: 1.3;
        }

        .score-block {
            flex-shrink: 0;
            text-align: center;
            min-width: 88px;
        }

        .score {
            font-size: 2em;
            font-weight: 800;
            color: var(--accent);
            letter-spacing: 3px;
        }

        .score-detail {
            font-size: 0.7em;
            color: var(--muted);
            margin-top: 2px;
        }

        .upcoming-time {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--accent);
        }

        .upcoming-vs {
            font-size: 0.78em;
            color: var(--muted);
            margin-top: 3px;
        }

        /* ‚îÄ‚îÄ Detail buttons ‚îÄ‚îÄ */
        .detail-btn-row {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 14px;
            padding-top: 12px;
            border-top: 1px solid var(--card-border);
        }

        .detail-btn {
            background: transparent;
            border: 1.5px solid;
            padding: 5px 16px;
            border-radius: 18px;
            cursor: pointer;
            font-size: 0.76em;
            font-weight: 600;
            transition: all 0.15s;
            letter-spacing: 0.2px;
        }

        .btn-stats {
            border-color: var(--accent);
            color: var(--accent);
        }

        .btn-stats:hover, .btn-stats.btn-active {
            background: var(--accent);
            color: #fff;
        }

        .btn-fpl {
            border-color: var(--fpl-color);
            color: var(--fpl-color);
        }

        .btn-fpl:hover, .btn-fpl.btn-active {
            background: var(--fpl-color);
            color: #fff;
        }

        /* ‚îÄ‚îÄ Detail tab row inside stats panel ‚îÄ‚îÄ */
        .detail-tab-row {
            display: flex;
            gap: 8px;
            margin-bottom: 14px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--card-border);
        }

        .detail-tab-btn {
            background: transparent;
            border: 1.5px solid var(--card-border);
            padding: 5px 14px;
            border-radius: 16px;
            cursor: pointer;
            font-size: 0.76em;
            font-weight: 600;
            color: var(--muted);
            transition: all 0.15s;
        }

        .detail-tab-btn:hover { border-color: var(--accent); color: var(--accent); }

        .detail-tab-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: #fff;
        }

        .detail-tab-btn.fpl-tab.active {
            background: var(--fpl-color);
            border-color: var(--fpl-color);
        }

        .panel-content { display: none; }
        .panel-content.active { display: block; }

        /* ‚îÄ‚îÄ Panels ‚îÄ‚îÄ */
        .detail-panel {
            display: none;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--card-border);
            animation: fadeDown 0.2s ease;
        }

        .detail-panel.panel-open { display: block; }

        @keyframes fadeDown {
            from { opacity: 0; transform: translateY(-5px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        .details-section { margin-bottom: 20px; }
        .details-section:last-child { margin-bottom: 0; }

        .details-title {
            font-size: 0.72em;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--accent);
            margin-bottom: 10px;
            padding-bottom: 4px;
            border-bottom: 1px solid var(--card-border);
        }

        .details-title.fpl-title { color: var(--fpl-color); }

        /* ‚îÄ‚îÄ Timeline ‚îÄ‚îÄ */
        .timeline {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .tl-event {
            display: grid;
            grid-template-columns: 1fr 56px 1fr;
            gap: 6px;
            align-items: center;
            font-size: 0.8em;
            padding: 4px 2px;
            border-radius: 6px;
        }

        .tl-event:hover { background: rgba(22,163,74,0.05); }

        .tl-home, .tl-away {
            display: flex;
            flex-direction: column;
            gap: 1px;
        }

        .tl-home { text-align: right; align-items: flex-end; }
        .tl-away { text-align: left; align-items: flex-start; }

        .tl-center {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1px;
        }

        .tl-icon { font-size: 1.1em; line-height: 1; }

        .tl-min {
            font-size: 0.78em;
            color: var(--muted);
            white-space: nowrap;
        }

        .tl-player {
            font-weight: 600;
            color: var(--text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .tl-sub-detail {
            font-size: 0.85em;
            color: var(--muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .tl-assist { font-size: 0.85em; color: var(--muted); }

        .tl-period {
            color: var(--muted);
            font-size: 0.78em;
            text-align: center;
            padding: 6px 0 2px;
            border-top: 1px dashed var(--card-border);
            margin-top: 4px;
            grid-column: 1 / -1;
        }

        .tl-period:first-child { border-top: none; margin-top: 0; }

        .no-events {
            font-size: 0.82em;
            color: var(--muted);
            text-align: center;
            padding: 8px;
        }

        /* ‚îÄ‚îÄ Match stats bars ‚îÄ‚îÄ */
        .stats-teams {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px;
            margin-bottom: 12px;
            font-size: 0.78em;
            font-weight: 600;
        }

        .stats-teams .home-label { text-align: left;  color: var(--bar-home); }
        .stats-teams .away-label { text-align: right; color: var(--bar-away); }

        .stat-row {
            display: grid;
            grid-template-columns: 2.5rem 1fr 2.5rem;
            gap: 8px;
            align-items: center;
            margin: 5px 0;
            font-size: 0.8em;
        }

        .stat-val { font-weight: 700; font-size: 0.95em; }
        .stat-val.home-v { text-align: right; color: var(--bar-home); }
        .stat-val.away-v { text-align: left;  color: var(--bar-away); }

        .stat-center {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }

        .stat-bar-track {
            width: 100%;
            height: 5px;
            display: flex;
            border-radius: 3px;
            overflow: hidden;
            background: #bae6fd;
        }

        .bar-h { height: 100%; background: var(--bar-home); transition: width 0.5s ease; }
        .bar-a { height: 100%; background: var(--bar-away); transition: width 0.5s ease; }

        .stat-label {
            font-size: 0.78em;
            color: var(--muted);
            white-space: nowrap;
        }

        /* ‚îÄ‚îÄ FPL table ‚îÄ‚îÄ */
        .fpl-section { margin-bottom: 18px; }
        .fpl-section:last-child { margin-bottom: 0; }

        .fpl-team-name {
            font-size: 0.8em;
            font-weight: 700;
            color: var(--fpl-color);
            background: #f5f3ff;
            border: 1px solid #ddd6fe;
            padding: 3px 10px;
            border-radius: 6px;
            margin-bottom: 8px;
            display: inline-block;
        }

        .fpl-table {
            display: flex;
            flex-direction: column;
            gap: 1px;
        }

        .fpl-row {
            display: grid;
            grid-template-columns: 34px 1fr 36px 26px 26px 26px 26px 26px 34px;
            gap: 4px;
            font-size: 0.76em;
            padding: 4px 3px;
            border-radius: 4px;
            align-items: center;
        }

        .fpl-row:not(.fpl-hdr):hover { background: rgba(124,58,237,0.04); }

        .fpl-hdr {
            font-size: 0.7em;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--card-border);
            margin-bottom: 2px;
        }

        .fpl-pos {
            font-size: 0.82em;
            font-weight: 700;
            text-align: center;
            padding: 1px 2px;
            border-radius: 3px;
        }

        .fpl-pos-gk  { background: #fef9c3; color: #713f12; }
        .fpl-pos-def { background: #dbeafe; color: #1e40af; }
        .fpl-pos-mid { background: #ede9fe; color: #5b21b6; }
        .fpl-pos-fwd { background: #fee2e2; color: #991b1b; }

        .fpl-name {
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .fpl-name.row-starred { font-weight: 700; color: #15803d; }

        .fpl-num { text-align: center; color: var(--muted); }
        .fpl-num.nonzero { color: var(--text); font-weight: 600; }

        .fpl-pts {
            text-align: center;
            font-weight: 800;
            border-radius: 4px;
            padding: 2px 1px;
        }

        .pts-high { color: #15803d; }
        .pts-med  { color: #7c3aed; }
        .pts-low  { color: var(--muted); }

        /* ‚îÄ‚îÄ Errors ‚îÄ‚îÄ */
        .error-msg {
            text-align: center;
            padding: 48px 20px;
            color: #dc2626;
            font-size: 0.95em;
            line-height: 1.7;
        }

        .details-error {
            text-align: center;
            padding: 14px;
            color: #dc2626;
            font-size: 0.82em;
        }

        /* ‚îÄ‚îÄ Standings ‚îÄ‚îÄ */
        .standings-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85em;
        }

        .standings-table th {
            text-align: center;
            padding: 6px 4px;
            font-size: 0.78em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--muted);
            border-bottom: 2px solid var(--card-border);
        }

        .standings-table th:nth-child(2) { text-align: left; }

        .standings-table td {
            padding: 7px 4px;
            text-align: center;
            border-bottom: 1px solid var(--card-border);
        }

        .standings-table td:nth-child(2) { text-align: left; }
        .standings-table tr:last-child td { border-bottom: none; }
        .standings-table tr:hover td { background: rgba(14,165,233,0.07); }

        .st-rank {
            font-weight: 700;
            color: var(--muted);
            width: 28px;
        }

        .st-team {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .st-team img {
            width: 22px;
            height: 22px;
            object-fit: contain;
            flex-shrink: 0;
        }

        .st-pts { font-weight: 800; color: var(--accent); }
        .st-gd  { font-weight: 600; }

        .zone-bar {
            display: inline-block;
            width: 4px;
            height: 20px;
            border-radius: 2px;
            vertical-align: middle;
            margin-right: 4px;
            flex-shrink: 0;
        }

        .standings-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 16px;
            font-size: 0.75em;
            color: var(--muted);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 2px;
            flex-shrink: 0;
        }

        /* ‚îÄ‚îÄ Live indicator ‚îÄ‚îÄ */
        .live-banner {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 8px 14px;
            margin-bottom: 16px;
            font-size: 0.8em;
            color: #dc2626;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #dc2626;
            animation: pulse 1s infinite;
            flex-shrink: 0;
        }

        /* ‚îÄ‚îÄ Unavailable notice ‚îÄ‚îÄ */
        .unavailable-msg {
            text-align: center;
            padding: 60px 20px;
            color: var(--muted);
            line-height: 1.8;
        }

        .unavailable-msg .um-icon { font-size: 2.5em; margin-bottom: 14px; }
        .unavailable-msg h3 { color: var(--text); margin-bottom: 8px; font-size: 1.05em; }
        .unavailable-msg p { font-size: 0.88em; max-width: 340px; margin: 0 auto; }

        /* ‚îÄ‚îÄ Mobile ‚îÄ‚îÄ */
        @media (max-width: 768px) {
            .app-layout { flex-direction: column; }

            .sidebar {
                width: 100%;
                height: auto;
                position: static;
                display: flex;
                flex-direction: row;
                overflow-x: auto;
                padding: 0;
                scrollbar-width: none;
            }

            .sidebar::-webkit-scrollbar { display: none; }
            .sidebar-title { display: none; }

            .sidebar-section {
                display: flex;
                flex-direction: row;
                padding-top: 0;
                flex-shrink: 0;
            }

            .sidebar-section-label { display: none; }

            .league-btn {
                display: inline-flex;
                width: auto;
                white-space: nowrap;
                padding: 9px 13px;
                border-left: none;
                border-bottom: 3px solid transparent;
                flex-shrink: 0;
                font-size: 0.8em;
            }

            .league-btn.active {
                border-left-color: transparent;
                border-bottom-color: #4ade80;
            }
        }

        @media (max-width: 520px) {
            .team img { width: 40px; height: 40px; }
            .team-name { font-size: 0.76em; }
            .score { font-size: 1.7em; }
            .score-block { min-width: 68px; }
            .league-header-text h1 { font-size: 1.15em; }
            .tl-event { grid-template-columns: 1fr 48px 1fr; font-size: 0.74em; }
            .fpl-row { grid-template-columns: 30px 1fr 32px 22px 22px 22px 22px 22px 30px; font-size: 0.7em; }
        }
    </style>
</head>
<body>

<div class="app-layout">

    <!-- ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ -->
    <aside class="sidebar">
        <div class="sidebar-title">üèÜ Tulospalvelu</div>

        <div class="sidebar-section">
            <div class="sidebar-section-label">‚öΩ Jalkapallo</div>
            <button class="league-btn active" data-league="pl" onclick="switchLeague('pl')">
                <span class="lb-icon">üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø</span> Premier League
            </button>
            <button class="league-btn" data-league="laliga" onclick="switchLeague('laliga')">
                <span class="lb-icon">üá™üá∏</span> La Liga
            </button>
            <button class="league-btn" data-league="bl" onclick="switchLeague('bl')">
                <span class="lb-icon">üá©üá™</span> Bundesliga
            </button>
            <button class="league-btn" data-league="seriea" onclick="switchLeague('seriea')">
                <span class="lb-icon">üáÆüáπ</span> Serie A
            </button>
            <button class="league-btn" data-league="ligue1" onclick="switchLeague('ligue1')">
                <span class="lb-icon">üá´üá∑</span> Ligue 1
            </button>
            <button class="league-btn" data-league="ucl" onclick="switchLeague('ucl')">
                <span class="lb-icon">‚≠ê</span> Champions League
            </button>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-section-label">üèí J√§√§kiekko</div>
            <button class="league-btn" data-league="nhl" onclick="switchLeague('nhl')">
                <span class="lb-icon">üèí</span> NHL
            </button>
            <button class="league-btn" data-league="liiga" onclick="switchLeague('liiga')">
                <span class="lb-icon">üèí</span> Liiga
            </button>
        </div>
    </aside>

    <!-- ‚îÄ‚îÄ Main content ‚îÄ‚îÄ -->
    <div class="main-content">

        <!-- League header -->
        <div class="league-header">
            <img id="league-logo"
                 src="https://a.espncdn.com/i/leaguelogos/soccer/500/23.png"
                 alt="League" onerror="this.style.display='none'">
            <div class="league-header-text">
                <h1 id="league-name">Premier League</h1>
                <p id="league-subtitle">Englannin Valioliiga &mdash; Ottelutulokset &amp; ohjelma</p>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="results"   onclick="showTab('results',   this)">Viimeisimm√§t tulokset</button>
            <button class="tab-btn"        data-tab="upcoming"  onclick="showTab('upcoming',  this)">Tulevat ottelut</button>
            <button class="tab-btn"        data-tab="standings" onclick="showTab('standings', this)">Sarjataulukko</button>
        </div>

        <!-- Tab content -->
        <div class="container">
            <div id="results"   class="tab-content active">
                <div class="loading"><div class="spinner"></div>Ladataan tuloksia...</div>
            </div>
            <div id="upcoming"  class="tab-content">
                <div class="loading"><div class="spinner"></div>Ladataan otteluohjelmaa...</div>
            </div>
            <div id="standings" class="tab-content">
                <div class="loading"><div class="spinner"></div>Ladataan sarjataulukkoa...</div>
            </div>
        </div>

    </div><!-- /main-content -->
</div><!-- /app-layout -->

<script>
'use strict';

// ‚îÄ‚îÄ League configurations ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const LEAGUES = {
    pl: {
        key:'pl', sport:'soccer', id:'eng.1',
        name:'Premier League', subtitle:'Englannin Valioliiga \u2014 Ottelutulokset & ohjelma',
        logo:'https://a.espncdn.com/i/leaguelogos/soccer/500/23.png', hasFPL: true
    },
    laliga: {
        key:'laliga', sport:'soccer', id:'esp.1',
        name:'La Liga', subtitle:'Espanjan La Liga \u2014 Ottelutulokset & ohjelma',
        logo:'https://a.espncdn.com/i/leaguelogos/soccer/500/15.png'
    },
    bl: {
        key:'bl', sport:'soccer', id:'ger.1',
        name:'Bundesliga', subtitle:'Saksan Bundesliiga \u2014 Ottelutulokset & ohjelma',
        logo:'https://a.espncdn.com/i/leaguelogos/soccer/500/10.png'
    },
    seriea: {
        key:'seriea', sport:'soccer', id:'ita.1',
        name:'Serie A', subtitle:'Italian Serie A \u2014 Ottelutulokset & ohjelma',
        logo:'https://a.espncdn.com/i/leaguelogos/soccer/500/12.png'
    },
    ligue1: {
        key:'ligue1', sport:'soccer', id:'fra.1',
        name:'Ligue 1', subtitle:'Ranskan Ligue 1 \u2014 Ottelutulokset & ohjelma',
        logo:'https://a.espncdn.com/i/leaguelogos/soccer/500/9.png'
    },
    ucl: {
        key:'ucl', sport:'soccer', id:'uefa.champions',
        name:'Champions League', subtitle:'UEFA Mestareiden liiga \u2014 Ottelutulokset & ohjelma',
        logo:'https://a.espncdn.com/i/leaguelogos/soccer/500/2.png'
    },
    nhl: {
        key:'nhl', sport:'hockey', id:'nhl',
        name:'NHL', subtitle:'National Hockey League \u2014 Ottelutulokset & ohjelma',
        logo:'https://a.espncdn.com/i/leaguelogos/hockey/500/1.png'
    },
    liiga: {
        key:'liiga', sport:'hockey', id: null,
        name:'Liiga', subtitle:'Suomen SM-Liiga \u2014 Ottelutulokset & ohjelma',
        logo:'', unavailable: true
    },
};

let currentLeagueKey = 'pl';
let currentTab = 'results';

function getLeague() { return LEAGUES[currentLeagueKey]; }

// ‚îÄ‚îÄ FPL API (CORS proxy) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const FPL_PROXY = 'https://corsproxy.io/?url=';
const FPL_BASE  = 'https://fantasy.premierleague.com/api';

async function fplFetch(path) {
    const url = FPL_BASE + path;
    const res = await fetch(FPL_PROXY + encodeURIComponent(url));
    if (!res.ok) throw new Error(`FPL HTTP ${res.status}`);
    return res.json();
}

let   fplBootstrapCache = null;
let   fplFixturesCache  = null;
const fplEventCache     = {};
const detailCache       = {};

async function getFplBootstrap() {
    if (!fplBootstrapCache) fplBootstrapCache = await fplFetch('/bootstrap-static/');
    return fplBootstrapCache;
}
async function getFplFixtures() {
    if (!fplFixturesCache) fplFixturesCache = await fplFetch('/fixtures/');
    return fplFixturesCache;
}
async function getFplEventLive(gw) {
    if (!fplEventCache[gw]) fplEventCache[gw] = await fplFetch(`/event/${gw}/live/`);
    return fplEventCache[gw];
}

// ESPN team displayName ‚Üí FPL short_name
const ESPN_TO_FPL = {
    'Arsenal':'ARS','Aston Villa':'AVL','AFC Bournemouth':'BOU','Bournemouth':'BOU',
    'Brentford':'BRE','Brighton & Hove Albion':'BHA','Brighton':'BHA',
    'Burnley':'BUR','Chelsea':'CHE','Crystal Palace':'CRY','Everton':'EVE',
    'Fulham':'FUL','Ipswich Town':'IPS','Ipswich':'IPS',
    'Leeds United':'LEE','Leeds':'LEE','Leicester City':'LEI','Leicester':'LEI',
    'Liverpool':'LIV','Manchester City':'MCI','Manchester United':'MUN',
    'Newcastle United':'NEW','Newcastle':'NEW','Nottingham Forest':'NFO',"Nott'm Forest":'NFO',
    'Southampton':'SOU','Sunderland':'SUN','Tottenham Hotspur':'TOT','Spurs':'TOT',
    'West Ham United':'WHU','West Ham':'WHU','Wolverhampton Wanderers':'WOL','Wolves':'WOL',
};
const POS_NAME = { 1:'GK', 2:'DEF', 3:'MID', 4:'FWD' };

// ‚îÄ‚îÄ API URL builders ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function scoreboardUrl(league, from, to) {
    const base = `https://site.api.espn.com/apis/site/v2/sports/${league.sport}/${league.id}/scoreboard`;
    return `${base}?dates=${toESPNDate(from)}-${toESPNDate(to)}&limit=100`;
}
function summaryUrl(league, eventId) {
    return `https://site.api.espn.com/apis/site/v2/sports/${league.sport}/${league.id}/summary?event=${eventId}`;
}
function standingsUrl(league) {
    return `https://site.api.espn.com/apis/v2/sports/${league.sport}/${league.id}/standings`;
}

// ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function fmtDate(iso) {
    return new Date(iso).toLocaleDateString('fi-FI', {
        weekday:'long', day:'numeric', month:'long', year:'numeric'
    });
}
function fmtTime(iso) {
    return new Date(iso).toLocaleTimeString('fi-FI', { hour:'2-digit', minute:'2-digit' });
}
function toESPNDate(d) {
    return `${d.getFullYear()}${String(d.getMonth()+1).padStart(2,'0')}${String(d.getDate()).padStart(2,'0')}`;
}

// ‚îÄ‚îÄ UI: League / Tab switching ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showTab(tab, btn) {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById(tab).classList.add('active');
    currentTab = tab;

    // Lazy load if still showing spinner
    const el = document.getElementById(tab);
    if (el.querySelector('.loading')) {
        const league = getLeague();
        if (!league.unavailable) loadTabContent(tab, league);
    }
}

function loadTabContent(tab, league) {
    switch (tab) {
        case 'results':   loadResults(league);   break;
        case 'upcoming':  loadUpcoming(league);  break;
        case 'standings': loadStandings(league); break;
    }
}

function updateLeagueHeader(league) {
    document.getElementById('league-name').textContent    = league.name;
    document.getElementById('league-subtitle').textContent = league.subtitle;
    const logo = document.getElementById('league-logo');
    if (league.logo) {
        logo.src = league.logo;
        logo.style.display = '';
    } else {
        logo.style.display = 'none';
    }
}

function unavailableHTML() {
    return `<div class="unavailable-msg">
        <div class="um-icon">‚ö†Ô∏è</div>
        <h3>Tietoja ei saatavilla</h3>
        <p>SM-Liigan ottelutiedot eiv√§t ole saatavilla ESPN:n avoimesta rajapinnasta. Ominaisuus on kehitteill√§.</p>
    </div>`;
}

function switchLeague(leagueKey) {
    if (leagueKey === currentLeagueKey) return;

    stopLiveRefresh();

    document.querySelectorAll('.league-btn').forEach(b => b.classList.remove('active'));
    document.querySelector(`[data-league="${leagueKey}"]`).classList.add('active');

    currentLeagueKey = leagueKey;
    currentTab = 'results';

    const league = LEAGUES[leagueKey];
    updateLeagueHeader(league);

    // Reset tabs to Results
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    document.querySelector('[data-tab="results"]').classList.add('active');
    document.getElementById('results').classList.add('active');

    const LOADING = '<div class="loading"><div class="spinner"></div>Ladataan...</div>';
    document.getElementById('results').innerHTML   = LOADING;
    document.getElementById('upcoming').innerHTML  = LOADING;
    document.getElementById('standings').innerHTML = LOADING;

    if (league.unavailable) {
        const msg = unavailableHTML();
        document.getElementById('results').innerHTML   = msg;
        document.getElementById('upcoming').innerHTML  = msg;
        document.getElementById('standings').innerHTML = msg;
    } else {
        loadResults(league);
        // upcoming and standings are loaded lazily when their tab is clicked
    }
}

// ‚îÄ‚îÄ Scoreboard fetch ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function fetchMatches(league, from, to) {
    const url = scoreboardUrl(league, from, to);
    const res = await fetch(url);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    return (await res.json()).events || [];
}

// ‚îÄ‚îÄ Timeline ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SOCCER_ICONS = {
    'goal':'‚öΩ','own-goal':'‚öΩ','yellow-card':'üü®','red-card':'üü•',
    'yellow-red-card':'üü®üü•','substitution':'üîÑ','penalty-goal':'‚öΩ','missed-penalty':'‚ùå',
};
const HOCKEY_ICONS = {
    'goal':'üèí','penalty':'‚õî','penalty-shot':'üèí','shootout-goal':'üèí','goalie-change':'ü•Ö',
};

function buildTimeline(keyEvents, homeTeamId, sport) {
    const isHockey = sport === 'hockey';
    const SHOW = isHockey
        ? new Set(['goal','penalty','penalty-shot','shootout-goal'])
        : new Set(['goal','own-goal','yellow-card','red-card','yellow-red-card','substitution','penalty-goal','missed-penalty']);
    const ICONS = isHockey ? HOCKEY_ICONS : SOCCER_ICONS;

    const events = keyEvents.filter(e => SHOW.has(e.type?.type));
    if (!events.length) return '<div class="no-events">Ei kirjattuja tapahtumia</div>';

    let html = '<div class="timeline">';
    let curPeriod = null;

    for (const e of events) {
        const period = e.period?.number ?? 0;
        const type   = e.type.type;
        const min    = e.clock?.displayValue || '';
        const icon   = ICONS[type] || '‚Ä¢';
        const isHome = e.team?.id === homeTeamId;
        const parts  = e.participants || [];

        if (period !== curPeriod) {
            curPeriod = period;
            let lbl;
            if (isHockey) {
                lbl = period <= 3 ? `${period}. er√§` : 'Jatkoaika / Voittolaukauskilpailu';
            } else {
                lbl = period === 1 ? '1. puoliaika'
                    : period === 2 ? '2. puoliaika'
                    : period >= 3  ? 'Jatkoaika' : '';
            }
            if (lbl) html += `<div class="tl-period">${lbl}</div>`;
        }

        let content = '';
        if (type === 'substitution') {
            const pOn  = parts[0]?.athlete?.displayName ?? '?';
            const pOff = parts[1]?.athlete?.displayName ?? '';
            content = `<div class="tl-player">‚ñ≤ ${pOn}</div>
                       ${pOff ? `<div class="tl-sub-detail">‚ñº ${pOff}</div>` : ''}`;
        } else {
            const scorer   = parts[0]?.athlete?.displayName ?? '';
            const assister = parts[1]?.athlete?.displayName ?? '';
            const showA = assister && ['goal','penalty-goal','shootout-goal'].includes(type);
            content = `<div class="tl-player">${scorer}</div>
                       ${showA ? `<div class="tl-assist">‚Ü≥ ${assister}</div>` : ''}`;
        }

        html += `<div class="tl-event">
            <div class="tl-home">${isHome  ? content : ''}</div>
            <div class="tl-center"><span class="tl-icon">${icon}</span><span class="tl-min">${min}</span></div>
            <div class="tl-away">${!isHome ? content : ''}</div>
        </div>`;
    }

    return html + '</div>';
}

// ‚îÄ‚îÄ Stats bars ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const STAT_DEFS_SOCCER = [
    { key:'Possession',    label:'Pallonhallinta %', isPct:true  },
    { key:'SHOTS',         label:'Laukaukset',        isPct:false },
    { key:'ON GOAL',       label:'Maalilaukaukset',   isPct:false },
    { key:'Corner Kicks',  label:'Kulmapotkut',       isPct:false },
    { key:'Fouls',         label:'Rikkomukset',       isPct:false },
    { key:'Offsides',      label:'Paitsiot',          isPct:false },
    { key:'Saves',         label:'Torjunnat',         isPct:false },
    { key:'Yellow Cards',  label:'Keltaiset kortit',  isPct:false },
    { key:'Red Cards',     label:'Punaiset kortit',   isPct:false },
];
const STAT_DEFS_HOCKEY = [
    { key:'shots',                   label:'Laukaukset',          isPct:false },
    { key:'powerPlayGoals',          label:'Ylivoimamaalit',      isPct:false },
    { key:'powerPlayOpportunities',  label:'Ylivoimatilanteet',   isPct:false },
    { key:'faceOffWinPercent',       label:'Aloitusvoitot %',     isPct:true  },
    { key:'hits',                    label:'Taklaukset',          isPct:false },
    { key:'blocked',                 label:'Blokatut laukaukset', isPct:false },
    { key:'pims',                    label:'Rangaistusmin.',      isPct:false },
];

function buildStats(bsTeams, homeTeam, awayTeam, sport) {
    const homeBS = bsTeams.find(t => t.homeAway === 'home');
    const awayBS = bsTeams.find(t => t.homeAway === 'away');
    if (!homeBS || !awayBS) return '';

    const defs = sport === 'hockey' ? STAT_DEFS_HOCKEY : STAT_DEFS_SOCCER;

    const getVal = (stats, key) => {
        const s = stats.find(s => s.label === key || s.name === key);
        return s ? parseFloat(s.displayValue) : null;
    };

    let html = `<div class="stats-teams">
        <span class="home-label">${homeTeam.shortDisplayName || homeTeam.displayName}</span>
        <span class="away-label">${awayTeam.shortDisplayName || awayTeam.displayName}</span>
    </div>`;

    let hasAny = false;
    for (const def of defs) {
        const hRaw = getVal(homeBS.statistics, def.key);
        const aRaw = getVal(awayBS.statistics, def.key);
        if (hRaw === null && aRaw === null) continue;
        hasAny = true;
        const hVal = hRaw ?? 0, aVal = aRaw ?? 0;
        const total = hVal + aVal;
        const hPct  = def.isPct ? Math.round(hVal) : (total === 0 ? 50 : Math.round(hVal / total * 100));
        const aPct  = 100 - hPct;
        const hDisp = def.isPct ? hVal.toFixed(1) + '%' : hVal;
        const aDisp = def.isPct ? aVal.toFixed(1) + '%' : aVal;

        html += `<div class="stat-row">
            <span class="stat-val home-v">${hDisp}</span>
            <div class="stat-center">
                <div class="stat-bar-track">
                    <div class="bar-h" style="width:${hPct}%"></div>
                    <div class="bar-a" style="width:${aPct}%"></div>
                </div>
                <span class="stat-label">${def.label}</span>
            </div>
            <span class="stat-val away-v">${aDisp}</span>
        </div>`;
    }

    return hasAny ? html : '';
}

async function loadMatchStats(panel, eventId, homeTeam, awayTeam, league) {
    const content = panel.querySelector('.stats-content');
    content.innerHTML = '<div class="spinner-sm"></div>';
    try {
        if (!detailCache[eventId]) {
            const res = await fetch(summaryUrl(league, eventId));
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            detailCache[eventId] = await res.json();
        }
        const data      = detailCache[eventId];
        const sport     = league.sport;
        const tlIcon    = sport === 'hockey' ? 'üèí' : '‚öΩ';
        const tlHTML    = buildTimeline(data.keyEvents || [], homeTeam.id, sport);
        const statsHTML = buildStats(data.boxscore?.teams || [], homeTeam, awayTeam, sport);

        content.innerHTML = `
            <div class="details-section">
                <div class="details-title">${tlIcon} Tapahtumat</div>
                ${tlHTML}
            </div>
            ${statsHTML ? `<div class="details-section">
                <div class="details-title">üìä Tilastot</div>
                ${statsHTML}
            </div>` : ''}`;
        panel.dataset.loaded = '1';
    } catch (err) {
        content.innerHTML = `<div class="details-error">Virhe: ${err.message}</div>`;
    }
}

// ‚îÄ‚îÄ FPL Stats ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildFplSection(players, fixtureId, teamName) {
    if (!players.length) return `<div class="no-events">Ei pelaajatietoja</div>`;

    let html = `<div class="fpl-team-name">${teamName}</div>`;
    html += `<div class="fpl-table">
        <div class="fpl-row fpl-hdr">
            <span>Pos</span><span>Pelaaja</span>
            <span style="text-align:center">Min</span>
            <span style="text-align:center">G</span>
            <span style="text-align:center">A</span>
            <span style="text-align:center">CS</span>
            <span style="text-align:center" title="Defensive Contribution (tackles + clearances + blocks + interceptions)">DC</span>
            <span style="text-align:center">Bon</span>
            <span style="text-align:center">Pts</span>
        </div>`;

    for (const p of players) {
        const fe = (p.live?.explain || []).find(e => e.fixture === fixtureId);
        if (!fe) continue;

        const stats = {};
        for (const s of fe.stats) stats[s.identifier] = s;

        const mins = stats.minutes?.value ?? 0;
        if (mins === 0) continue;

        const goals   = stats.goals_scored?.value ?? 0;
        const assists = stats.assists?.value ?? 0;
        const cs      = stats.clean_sheets?.value ?? 0;
        const bonus   = stats.bonus?.value ?? 0;
        const yc      = stats.yellow_cards?.value ?? 0;
        const rc      = stats.red_cards?.value ?? 0;
        const og      = stats.own_goals?.value ?? 0;
        const saves   = stats.saves?.value ?? 0;
        const penSav  = stats.penalties_saved?.value ?? 0;
        const dc      = p.live.stats.defensive_contribution ?? 0;
        const totalPts = fe.stats.reduce((sum, s) => sum + s.points, 0);

        const pos    = POS_NAME[p.element_type];
        const posCls = pos.toLowerCase();

        let nameExtra = '';
        if (yc) nameExtra += ' üü®';
        if (rc) nameExtra += ' üü•';
        if (og) nameExtra += ' ‚öΩ(og)';
        if (saves >= 3) nameExtra += ` üß§${saves}`;
        if (penSav) nameExtra += ' ‚úã';

        const isSub    = stats.starts?.value === 0;
        const minLabel = isSub ? `‚Üë${mins}'` : `${mins}'`;
        const ptsCls   = totalPts >= 10 ? 'pts-high' : totalPts >= 6 ? 'pts-med' : 'pts-low';
        const nameCls  = totalPts >= 10 ? 'fpl-name row-starred' : 'fpl-name';
        const csLabel  = (pos === 'GK' || pos === 'DEF' || pos === 'MID') ? (cs ? '‚úì' : '‚Äì') : '‚Äì';

        html += `<div class="fpl-row">
            <span class="fpl-pos fpl-pos-${posCls}">${pos}</span>
            <span class="${nameCls}">${p.web_name}${nameExtra}</span>
            <span class="fpl-num" style="color:var(--muted);font-size:0.9em">${minLabel}</span>
            <span class="fpl-num ${goals   ? 'nonzero' : ''}">${goals   || '‚Äì'}</span>
            <span class="fpl-num ${assists ? 'nonzero' : ''}">${assists || '‚Äì'}</span>
            <span class="fpl-num" style="color:${cs ? '#15803d' : 'var(--muted)'}">${csLabel}</span>
            <span class="fpl-num ${dc      ? 'nonzero' : ''}">${dc      || '‚Äì'}</span>
            <span class="fpl-num ${bonus   ? 'nonzero' : ''}">${bonus   || '‚Äì'}</span>
            <span class="fpl-pts ${ptsCls}">${totalPts}</span>
        </div>`;
    }

    return html + '</div>';
}

async function loadFplStats(div, ev, homeTeam, awayTeam) {
    div.innerHTML = '<div class="spinner-sm"></div>';
    try {
        const bootstrap = await getFplBootstrap();

        const shortToId = {};
        for (const t of bootstrap.teams) shortToId[t.short_name] = t.id;

        const homeShort = ESPN_TO_FPL[homeTeam.displayName];
        const awayShort = ESPN_TO_FPL[awayTeam.displayName];

        if (!homeShort || !awayShort) {
            throw new Error(`Joukkueen nimi ei vastaa FPL-dataa (${homeTeam.displayName} / ${awayTeam.displayName})`);
        }

        const homeId = shortToId[homeShort];
        const awayId = shortToId[awayShort];

        const fixtures  = await getFplFixtures();
        const matchDate = ev.date.slice(0, 10);

        const fixture = fixtures.find(f => {
            if (!f.kickoff_time) return false;
            const fd = f.kickoff_time.slice(0, 10);
            return fd === matchDate && f.team_h === homeId && f.team_a === awayId;
        });

        if (!fixture || !fixture.event) throw new Error('FPL-ottelua ei l√∂ydy tai peli on lyk√§tty');

        const liveData = await getFplEventLive(fixture.event);
        const liveMap  = {};
        for (const el of liveData.elements) liveMap[el.id] = el;

        const getPlayers = (teamId) =>
            bootstrap.elements
                .filter(p => p.team === teamId)
                .map(p => ({ ...p, live: liveMap[p.id] || null }))
                .filter(p => {
                    if (!p.live) return false;
                    const fe = (p.live.explain || []).find(e => e.fixture === fixture.id);
                    return fe && fe.stats.some(s => s.identifier === 'minutes' && s.value > 0);
                })
                .sort((a, b) => {
                    if (a.element_type !== b.element_type) return a.element_type - b.element_type;
                    const ptA = (a.live.explain||[]).find(e=>e.fixture===fixture.id)?.stats.reduce((s,x)=>s+x.points,0)??0;
                    const ptB = (b.live.explain||[]).find(e=>e.fixture===fixture.id)?.stats.reduce((s,x)=>s+x.points,0)??0;
                    return ptB - ptA;
                });

        const homePlayers = getPlayers(homeId);
        const awayPlayers = getPlayers(awayId);

        div.innerHTML = `
            <div class="details-section">
                <div class="details-title fpl-title">‚öΩ FPL-pisteet ‚Äî Kierros ${fixture.event}</div>
                <div class="fpl-section">${buildFplSection(homePlayers, fixture.id, homeTeam.displayName)}</div>
                <div class="fpl-section">${buildFplSection(awayPlayers, fixture.id, awayTeam.displayName)}</div>
                <div style="font-size:0.68em;color:var(--muted);margin-top:10px;text-align:center">
                    ‚Üë = tullut vaihdossa &nbsp;|&nbsp; üü®üü• = kortit &nbsp;|&nbsp; üß§ = torjunnat &nbsp;|&nbsp; ‚úã = penaltyltorjunta
                </div>
            </div>`;
        div.dataset.loaded = '1';
    } catch (err) {
        div.innerHTML = `<div class="details-error">FPL-tilastoja ei saatavilla: ${err.message}</div>`;
    }
}

// ‚îÄ‚îÄ Card creation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function createCard(ev, league) {
    const comp   = ev.competitions[0];
    const home   = comp.competitors.find(c => c.homeAway === 'home');
    const away   = comp.competitors.find(c => c.homeAway === 'away');
    const status = comp.status.type;
    const isPost = status.state === 'post';
    const isLive = status.state === 'in';
    const canBtn = isPost || isLive;
    const hasFPL = !!(league.hasFPL && canBtn);

    let statusClass = 'status-pre', statusText = fmtTime(ev.date);
    if (isPost) { statusClass = 'status-ft';   statusText = status.shortDetail || 'FT'; }
    if (isLive) { statusClass = 'status-live'; statusText = status.detail      || 'LIVE'; }

    let centerHTML;
    if (isPost || isLive) {
        centerHTML = `<div class="score-block">
            <div class="score">${home.score}&ndash;${away.score}</div>
            <div class="score-detail">${isLive ? status.displayClock || '' : 'Lopputulos'}</div>
        </div>`;
    } else {
        centerHTML = `<div class="score-block">
            <div class="upcoming-time">${fmtTime(ev.date)}</div>
            <div class="upcoming-vs">vs</div>
        </div>`;
    }

    const venue = comp.venue?.fullName ?? '';
    const card  = document.createElement('div');
    card.className = 'match-card' + (canBtn ? ' has-btns' : '');

    card.innerHTML = `
        <div class="match-meta">
            <span>${fmtDate(ev.date)}</span>
            <span class="match-status ${statusClass}">${statusText}</span>
            <span>${venue}</span>
        </div>
        <div class="match-teams">
            <div class="team">
                <img src="${home.team.logo}" alt="${home.team.displayName}"
                     onerror="this.style.visibility='hidden'">
                <div class="team-name">${home.team.displayName}</div>
            </div>
            ${centerHTML}
            <div class="team">
                <img src="${away.team.logo}" alt="${away.team.displayName}"
                     onerror="this.style.visibility='hidden'">
                <div class="team-name">${away.team.displayName}</div>
            </div>
        </div>
        ${canBtn ? `
        <div class="detail-panel stats-panel">
            ${hasFPL ? `<div class="detail-tab-row">
                <button class="detail-tab-btn stats-tab active">üìä Ottelutapahtumat</button>
                <button class="detail-tab-btn fpl-tab">‚öΩ FPL Pisteet</button>
            </div>` : ''}
            <div class="panel-content stats-content active"></div>
            ${hasFPL ? '<div class="panel-content fpl-content"></div>' : ''}
        </div>` : ''}`;

    if (canBtn) {
        const statsPanel   = card.querySelector('.stats-panel');
        const statsContent = card.querySelector('.stats-content');
        const fplContent   = card.querySelector('.fpl-content');
        const statsTab     = card.querySelector('.stats-tab');
        const fplTab       = card.querySelector('.fpl-tab');

        // Click anywhere on card ‚Üí open stats, or close if already open
        card.addEventListener('click', () => {
            if (statsPanel.classList.contains('panel-open')) {
                statsPanel.classList.remove('panel-open');
                card.classList.remove('panel-open');
            } else {
                statsPanel.classList.add('panel-open');
                card.classList.add('panel-open');
                if (!statsPanel.dataset.loaded) {
                    loadMatchStats(statsPanel, ev.id, home.team, away.team, league);
                }
            }
        });

        if (hasFPL) {
            // Stats tab button
            statsTab.addEventListener('click', e => {
                e.stopPropagation();
                statsTab.classList.add('active');
                fplTab.classList.remove('active');
                statsContent.classList.add('active');
                fplContent.classList.remove('active');
            });

            // FPL tab button
            fplTab.addEventListener('click', e => {
                e.stopPropagation();
                fplTab.classList.add('active');
                statsTab.classList.remove('active');
                fplContent.classList.add('active');
                statsContent.classList.remove('active');
                if (!fplContent.dataset.loaded) {
                    loadFplStats(fplContent, ev, home.team, away.team);
                }
            });
        }
    }

    return card;
}

// ‚îÄ‚îÄ Render helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderEvents(events, containerId, upcoming, league) {
    const el = document.getElementById(containerId);
    el.innerHTML = '';

    if (!events.length) {
        el.innerHTML = '<div class="error-msg">Otteluita ei l√∂ytynyt.</div>';
        return;
    }

    const info = document.createElement('p');
    info.className = 'section-info';
    info.textContent = upcoming ? `${events.length} tulevaa ottelua` : `${events.length} ottelua`;
    el.appendChild(info);

    const groups = new Map();
    for (const ev of events) {
        const day = ev.date.slice(0, 10);
        if (!groups.has(day)) groups.set(day, []);
        groups.get(day).push(ev);
    }

    const days = [...groups.keys()].sort((a, b) =>
        upcoming ? a.localeCompare(b) : b.localeCompare(a));

    for (const day of days) {
        const dayEvents = groups.get(day).sort((a, b) =>
            upcoming ? new Date(a.date) - new Date(b.date)
                     : new Date(b.date) - new Date(a.date));

        const hdr = document.createElement('div');
        hdr.className = 'matchday-header';
        hdr.textContent = new Date(day + 'T12:00:00').toLocaleDateString('fi-FI', {
            weekday:'long', day:'numeric', month:'long', year:'numeric'
        });
        el.appendChild(hdr);
        for (const ev of dayEvents) el.appendChild(createCard(ev, league));
    }
}

function renderResultsWithLive(events, hasLive, league) {
    const el = document.getElementById('results');
    el.innerHTML = '';

    if (hasLive) {
        el.innerHTML = `<div class="live-banner">
            <div class="live-dot"></div>
            <span>Ottelu k√§ynniss√§ ‚Äî <span id="live-countdown">p√§ivitet√§√§n 60 sek. kuluttua</span></span>
        </div>`;
    }

    if (!events.length) {
        el.insertAdjacentHTML('beforeend', '<div class="error-msg">Otteluita ei l√∂ytynyt.</div>');
        return;
    }

    const info = document.createElement('p');
    info.className = 'section-info';
    info.textContent = `${events.length} ottelua`;
    el.appendChild(info);

    const groups = new Map();
    for (const ev of events) {
        const day = ev.date.slice(0, 10);
        if (!groups.has(day)) groups.set(day, []);
        groups.get(day).push(ev);
    }

    const days = [...groups.keys()].sort((a, b) => b.localeCompare(a));
    for (const day of days) {
        const dayEvents = groups.get(day).sort((a, b) => new Date(b.date) - new Date(a.date));
        const hdr = document.createElement('div');
        hdr.className = 'matchday-header';
        hdr.textContent = new Date(day + 'T12:00:00').toLocaleDateString('fi-FI', {
            weekday:'long', day:'numeric', month:'long', year:'numeric'
        });
        el.appendChild(hdr);
        for (const ev of dayEvents) el.appendChild(createCard(ev, league));
    }
}

// ‚îÄ‚îÄ Standings ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

// Flatten potentially nested ESPN standings children to get all team entries
function flattenEntries(node) {
    if (node.standings?.entries?.length) return node.standings.entries;
    if (!node.children) return [];
    let all = [];
    for (const child of node.children) all = all.concat(flattenEntries(child));
    return all;
}

async function loadStandings(league) {
    const el = document.getElementById('standings');
    if (league.unavailable) { el.innerHTML = unavailableHTML(); return; }

    try {
        const res = await fetch(standingsUrl(league));
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        const isHockey = league.sport === 'hockey';

        // Collect all entries
        let entries = flattenEntries(data);

        // For NHL, group by conference/division if children exist
        if (isHockey && data.children?.length) {
            renderHockeyStandings(el, data, league);
        } else {
            renderSoccerStandings(el, entries, league);
        }
    } catch (err) {
        el.innerHTML = `<div class="error-msg">Virhe sarjataulukon lataamisessa: ${err.message}</div>`;
    }
}

function standingsTableHTML(entries, cols, sport) {
    const zones = new Map();
    let rows = '';

    // Sort by rank stat
    entries.sort((a, b) => {
        const rA = Number(a.stats?.find(s => s.name === 'rank')?.displayValue ?? 99);
        const rB = Number(b.stats?.find(s => s.name === 'rank')?.displayValue ?? 99);
        return rA - rB;
    });

    for (const entry of entries) {
        const t     = entry.team;
        const stats = Object.fromEntries((entry.stats || []).map(s => [s.name, s.displayValue]));
        const note  = entry.note;
        const logo  = t.logos?.[0]?.href ?? '';

        let zoneBar = '';
        if (note?.color) {
            zoneBar = `<span class="zone-bar" style="background:${note.color}"></span>`;
            if (!zones.has(note.description)) zones.set(note.description, note.color);
        }

        const rank = Number(stats.rank ?? 0);

        let tdCells = '';
        for (const col of cols) {
            const raw = stats[col.name] ?? '';
            if (col.name === 'pointDifferential') {
                const n = Number(raw);
                const gdStr = raw.startsWith('+') || raw.startsWith('-') ? raw : (n >= 0 ? '+' + raw : raw);
                const gdColor = n > 0 ? '#15803d' : n < 0 ? '#dc2626' : '';
                tdCells += `<td class="st-gd" style="color:${gdColor}">${gdStr}</td>`;
            } else if (col.cls) {
                tdCells += `<td class="${col.cls}">${raw}</td>`;
            } else {
                tdCells += `<td>${raw}</td>`;
            }
        }

        rows += `<tr>
            <td class="st-rank">${rank}</td>
            <td><div class="st-team">
                ${zoneBar}
                <img src="${logo}" alt="${t.shortDisplayName}" onerror="this.style.visibility='hidden'">
                <span>${t.displayName}</span>
            </div></td>
            ${tdCells}
        </tr>`;
    }

    const thCells = cols.map(c => `<th>${c.label}</th>`).join('');

    const legendItems = [...zones.entries()].map(([desc, color]) => {
        const fi = desc === 'Champions League'         ? 'Mestareiden liiga'
                 : desc === 'Europa League'            ? 'Europa-liiga'
                 : desc === 'UEFA Conference League'   ? 'Conference-liiga'
                 : desc === 'Relegation'               ? 'Putoamisvy√∂hyke'
                 : desc === 'Playoff'                  ? 'Playoffs'
                 : desc;
        return `<div class="legend-item">
            <div class="legend-dot" style="background:${color}"></div>
            <span>${fi}</span>
        </div>`;
    }).join('');

    return { rows, thCells, legendHTML: legendItems };
}

function renderSoccerStandings(el, entries, league) {
    const cols = [
        { name:'gamesPlayed',      label:'P'   },
        { name:'wins',             label:'V'   },
        { name:'ties',             label:'T'   },
        { name:'losses',           label:'H'   },
        { name:'pointsFor',        label:'TM'  },
        { name:'pointsAgainst',    label:'PM'  },
        { name:'pointDifferential',label:'ME'  },
        { name:'points',           label:'Pts', cls:'st-pts' },
    ];

    const { rows, thCells, legendHTML } = standingsTableHTML(entries, cols, 'soccer');

    el.innerHTML = `
        <p class="section-info">Kausi 2025‚Äì26</p>
        <div class="match-card" style="padding:0;overflow:hidden">
            <table class="standings-table">
                <thead><tr><th>#</th><th style="text-align:left">Joukkue</th>${thCells}</tr></thead>
                <tbody>${rows}</tbody>
            </table>
        </div>
        <div class="standings-legend">${legendHTML}</div>`;
}

function renderHockeyStandings(el, data, league) {
    const cols = [
        { name:'gamesPlayed', label:'P'   },
        { name:'wins',        label:'V'   },
        { name:'losses',      label:'H'   },
        { name:'otLosses',    label:'OT'  },
        { name:'points',      label:'Pts', cls:'st-pts' },
        { name:'pointsFor',   label:'TM'  },
        { name:'pointsAgainst',label:'PM' },
    ];

    const thCells = cols.map(c => `<th>${c.label}</th>`).join('');
    let html = '<p class="section-info">Kausi 2025‚Äì26</p>';

    // Iterate conferences / divisions
    const conferences = data.children || [];

    for (const conf of conferences) {
        const confName = conf.name || conf.abbreviation || '';
        html += `<div class="matchday-header" style="margin-top:20px">${confName}</div>`;

        const divisions = conf.children || [conf];

        for (const div of divisions) {
            const divName = div.name || div.abbreviation || '';
            const entries = div.standings?.entries || [];

            if (!entries.length) continue;
            if (div !== conf) {
                html += `<div style="font-size:0.72em;text-transform:uppercase;letter-spacing:1px;color:var(--muted);margin:14px 0 6px;padding-left:4px">${divName}</div>`;
            }

            const { rows } = standingsTableHTML(entries, cols, 'hockey');

            html += `<div class="match-card" style="padding:0;overflow:hidden;margin-bottom:12px">
                <table class="standings-table">
                    <thead><tr><th>#</th><th style="text-align:left">Joukkue</th>${thCells}</tr></thead>
                    <tbody>${rows}</tbody>
                </table>
            </div>`;
        }
    }

    el.innerHTML = html;
}

// ‚îÄ‚îÄ Live auto-refresh ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let liveInterval   = null;
let liveCountdown  = 60;
let countdownTimer = null;

function stopLiveRefresh() {
    clearInterval(liveInterval);
    clearInterval(countdownTimer);
    liveInterval = countdownTimer = null;
}

function startLiveRefresh(league) {
    if (liveInterval) return;
    liveCountdown = 60;

    countdownTimer = setInterval(() => {
        liveCountdown--;
        const badge = document.getElementById('live-countdown');
        if (badge) badge.textContent = `P√§ivitet√§√§n ${liveCountdown} sek. kuluttua`;
        if (liveCountdown <= 0) liveCountdown = 60;
    }, 1000);

    liveInterval = setInterval(() => {
        liveCountdown = 60;
        refreshResults(league);
    }, 60000);
}

async function refreshResults(league) {
    if (!league || league.unavailable) { stopLiveRefresh(); return; }
    // Only refresh if still on same league
    if (league.key !== currentLeagueKey) { stopLiveRefresh(); return; }

    try {
        const to = new Date(), from = new Date();
        from.setDate(from.getDate() - 35);
        const events   = await fetchMatches(league, from, to);
        const live     = events.filter(e => e.competitions[0].status.type.state === 'in');
        const finished = events.filter(e => e.competitions[0].status.type.state === 'post');

        if (live.length === 0) stopLiveRefresh();

        renderResultsWithLive([...live, ...finished], live.length > 0, league);
    } catch {}
}

// ‚îÄ‚îÄ Load functions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadResults(league) {
    const el = document.getElementById('results');
    try {
        const to = new Date(), from = new Date();
        from.setDate(from.getDate() - 35);
        const events   = await fetchMatches(league, from, to);
        const live     = events.filter(e => e.competitions[0].status.type.state === 'in');
        const finished = events.filter(e => e.competitions[0].status.type.state === 'post');

        renderResultsWithLive([...live, ...finished], live.length > 0, league);

        if (live.length > 0) startLiveRefresh(league);
    } catch (err) {
        el.innerHTML = `<div class="error-msg">Virhe: ${err.message}</div>`;
    }
}

async function loadUpcoming(league) {
    const el = document.getElementById('upcoming');
    try {
        const from = new Date(), to = new Date();
        to.setDate(to.getDate() + 35);
        const events = await fetchMatches(league, from, to);
        renderEvents(events.filter(e => e.competitions[0].status.type.state === 'pre'), 'upcoming', true, league);
    } catch (err) {
        el.innerHTML = `<div class="error-msg">Virhe: ${err.message}</div>`;
    }
}

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const initialLeague = LEAGUES['pl'];
loadResults(initialLeague);
loadUpcoming(initialLeague);
loadStandings(initialLeague);
</script>

</body>
</html>
